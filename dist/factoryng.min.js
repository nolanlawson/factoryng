"use strict";angular.module("factoryng",[]).service("yngutils",function(){this.ASC=1,this.DESC=2,this.replace=function(a,b){for(var c in a)this.notDefined(b[c])&&delete a[c];for(c in b)a[c]=b[c]},this.isString=function(a){return"string"==typeof a||a instanceof String},this.isNumeric=function(a){return!isNaN(a)},this.notDefined=function(a){return"undefined"==typeof a},this.isFunction=function(a){return"function"==typeof a},this.clone=function(a){return JSON.parse(JSON.stringify(a))}}),angular.module("factoryng").factory("Yng",["$timeout","$q","yngutils",function(a,b,c){function d(a,b,c){a.scope&&a.scope.$emit(b,c)}var e=0,f=function(a,b,c){this.name=a,this.url=b,this.sortBy=c,this.model=[],this.map={},this.sorting=!1,this.scope=null},g=100,h=function(a){return function(b,d){var e=b.$priority-d.$priority;return a===c.DESC?-e:e}};return f.prototype.sortIfNeeded=function(){this.sortBy&&this.model.sort(this.sortBy===c.ASC||this.sortBy===c.DESC?h(this.sortBy):this.sortBy)},f.prototype.sortSoonIfNeeded=function(){if(!this.sorting){this.sorting=!0;var b=this;a(function(){b.sortIfNeeded(),b.sorting=!1},g)}},f.prototype.get=function(a){return this.map[a]},f.prototype.at=function(a){return this.model[a]},f.prototype.set=function(a){this.exists(a.$id)&&c.replace(this.get(a.$id),a)},f.prototype.setProperty=function(a,b,c){this.map[a][b]=c},f.prototype.exists=function(a){return this.map[a]?!0:!1},f.prototype.push=function(a){this.exists(a.$id)||(this.map[a.$id]=a,this.model.push(a))},f.prototype.remove=function(a){var b=this.map[a];return b&&(this.model.splice(this.model.indexOf(b),1),delete this.map[a]),b},f.prototype.length=function(){return this.model.length},f.prototype.bindModel=function(b){var c=this;return a(function(){return c.scope=b,b[c.name]=c.model,c.model})},f.prototype.applyFactory=function(a){var b=this;return function(){return a.apply(b,arguments)}},f.prototype.createDoc=function(b){var c=this;return a(function(){return c.push(b),d(c,"yng-create",b),b})},f.prototype.updateDoc=function(b){var c=this;return a(function(){return c.set(b),d(c,"yng-update",b),b})},f.prototype.removeDoc=function(b){var c=this.toId(b),e=this;return a(function(){var a=e.remove(c);return d(e,"yng-remove",a),a})},f.prototype.moveDoc=function(b){var c=this;return a(function(){return c.get(b.$id).$priority!==b.$priority&&(c.set(b),c.sortSoonIfNeeded()),d(c,"yng-move",b),b})},f.prototype.setPriorityIfNeeded=function(a){c.notDefined(a.$priority)&&(a.$priority=this.length())},f.prototype.toId=function(a){var b=c.isString(a)||c.isNumeric(a)?a:a.$id;if(c.notDefined(b))throw new Error("missing $id");return b},f.prototype.forEach=function(a,b){return this.model.forEach(a,b)},f.prototype.cleanup=function(){return b.when()},f.prototype.provider=function(){return null},f.prototype.destroy=function(){return this.model=[],this.map={},b.when()},f.prototype.error=function(a){this.onErrorCb&&this.onErrorCb(a)},f.prototype.onError=function(a){this.onErrorCb=a},f.prototype.nextId=function(){return++e},f.prototype.copyApi=function(a){var b=["sortIfNeeded","sortSoonIfNeeded","get","at","set","setProperty","exists","push","remove","length","forEach","cleanup","provider","destroy","onError"],c=this;b.forEach(function(b){a[b]=function(){return c[b].apply(c,arguments)}})},f}]);