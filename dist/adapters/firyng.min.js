"use strict";angular.module("factoryng").factory("Firyng",["$q","$timeout","Yng","yngutils",function(a,b,c,d){return function(e,f,g){function h(a){return function(b){return j(b),q.sortBy&&q.sortBy!==d.ASC&&q.sortIfNeeded(),q.bindModel(q.scope).then(a.resolve)}}function i(a){var b=a.val();return b.$id=a.name(),b.$priority=a.getPriority(),b}function j(a){a.forEach(function(a){q.push(i(a))})}function k(){s.on("child_added",m),s.on("child_changed",n),s.on("child_removed",o),s.on("child_moved",p)}function l(a,b){var c=d.clone(b);delete c.$id,delete c.$priority,a.setWithPriority(c,b.$priority)}function m(a){q.createDoc(i(a)).then(function(){q.emit("uptodate")})}function n(a){q.updateDoc(i(a)).then(function(){q.emit("uptodate")})}function o(a){q.removeDoc(a.name()).then(function(){q.emit("uptodate")})}function p(a){q.moveDoc(i(a)).then(function(){q.emit("uptodate")})}var q=new c(e,f,g);q.copyApi(this);var r=null,s=null;this.provider=function(){return r},this.bound=function(){return r?!0:!1},this.bind=function(b){if(this.bound())return q.bindModel(b);r=new Firebase(q.url),s=r.child(q.name),k();var c=a.defer();return q.scope=b,s.once("value",h(c)),c.promise},this.create=function(a){return b(function(){var b=s.push();return a.$id=b.name(),q.setPriorityIfNeeded(a),l(b,a),q.push(a),a})},this.update=function(a){return b(function(){return l(s.child(a.$id),a),q.set(a),a})},this.remove=function(a){return b(function(){var b=q.toId(a);s.child(b).remove();var c=q.remove(b);return c})},this.setPriority=function(a,c){return b(function(){var b=q.toId(a);s.child(b).setPriority(c),q.setProperty(b,"$priority",c);var d=q.get(b);return d})},this.destroy=function(b){if(b)return q.destroy();var c=a.defer();return s.remove(function(){q.destroy().then(c.resolve)}),c.promise}}}]);