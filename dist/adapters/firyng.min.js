"use strict";angular.module("factoryng").factory("Firyng",["$q","$timeout","Yng","yngutils",function(a,b,c,d){return function(b,e,f){function g(a){var b=a.val();return b.$id=a.name(),b.$priority=a.getPriority(),b}function h(a){a.forEach(function(a){o.push(g(a))})}function i(){q.on("child_added",o.applyFactory(k)),q.on("child_changed",o.applyFactory(l)),q.on("child_removed",o.applyFactory(m)),q.on("child_moved",o.applyFactory(n))}function j(a,b){var c=d.clone(b);delete c.$id,delete c.$priority,a.setWithPriority(c,b.$priority)}function k(a){o.createDoc(g(a))}function l(a){o.updateDoc(g(a))}function m(a){o.removeDoc(a.name())}function n(a){o.moveDoc(g(a))}var o=new c(b,e,f);o.copyApi(this);var p=null,q=null;this.provider=function(){return p},this.bind=function(b){if(p)return o.bindModel(b);var c=a.defer();return p=new Firebase(o.url),q=p.child(o.name),i(),q.once("value",function(a){h(a),o.sortBy&&o.sortBy!==d.ASC&&o.sortIfNeeded(),o.bindModel(b).then(function(){c.resolve(b[o.name])})}),c.promise},this.create=function(b){var c=a.defer(),d=q.push();return b.$id=d.name(),o.setPriorityIfNeeded(b),j(d,b),o.push(b),c.resolve(b),c.promise},this.update=function(b){var c=a.defer();return j(q.child(b.$id),b),o.set(b),c.resolve(b),c.promise},this.remove=function(b){var c=a.defer(),d=o.toId(b);return q.child(d).remove(),c.resolve(o.destroy(d)),c.promise},this.setPriority=function(b,c){var d=a.defer(),e=o.toId(b);return q.child(e).setPriority(c),o.setProperty(e,"$priority",c),d.resolve(o.get(e)),d.promise},this.destroy=function(){var b=a.defer();return q.remove(b.resolve),b.promise}}}]);