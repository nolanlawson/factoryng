!function t(e,n,r){function i(s,u){if(!n[s]){if(!e[s]){var c="function"==typeof require&&require;if(!u&&c)return c(s,!0);if(o)return o(s,!0);var p=new Error("Cannot find module '"+s+"'");throw p.code="MODULE_NOT_FOUND",p}var f=n[s]={exports:{}};e[s][0].call(f.exports,function(t){var n=e[s][1][t];return i(n?n:t)},f,f.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(){},{}],2:[function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function i(t){return"number"==typeof t}function o(t){return"object"==typeof t&&null!==t}function s(t){return void 0===t}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!i(t)||0>t||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,i,u,c,p;if(this._events||(this._events={}),"error"===t&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[t],s(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(i=arguments.length,u=new Array(i-1),c=1;i>c;c++)u[c-1]=arguments[c];n.apply(this,u)}else if(o(n)){for(i=arguments.length,u=new Array(i-1),c=1;i>c;c++)u[c-1]=arguments[c];for(p=n.slice(),i=p.length,c=0;i>c;c++)p[c].apply(this,u)}return!0},n.prototype.addListener=function(t,e){var i;if(!r(e))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?o(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,o(this._events[t])&&!this._events[t].warned){var i;i=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())}return this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){function n(){this.removeListener(t,n),i||(i=!0,e.apply(this,arguments))}if(!r(e))throw TypeError("listener must be a function");var i=!1;return n.listener=e,this.on(t,n),this},n.prototype.removeListener=function(t,e){var n,i,s,u;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],s=n.length,i=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(o(n)){for(u=s;u-->0;)if(n[u]===e||n[u].listener&&n[u].listener===e){i=u;break}if(0>i)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],r(n))this.removeListener(t,n);else for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.listenerCount=function(t,e){var n;return n=t._events&&t._events[e]?r(t._events[e])?1:t._events[e].length:0}},{}],3:[function(t,e){e.exports="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],4:[function(t,e){"use strict";var n=t("../yng-utils"),r=t("../yng");e.exports=function(e,i){var o=new r(e,i),s=new n(e);if("undefined"!=typeof window&&window.PouchDB)var u=window.PouchDB;else var u=t("pouchdb");return function(t,n,r,c){function p(t){t&&l.yng.error(t)}function f(){l.yng.emit("uptodate")}function h(t){return function(){return l.map().then(function(){return l.yng.sortIfNeeded(),l.yng.bindModel(l.yng.scope).then(t.resolve)})}}function a(t){var e={since:t.update_seq,live:!0};e=s.merge(e,s.get(l.yng.props,"changes","opts")),l.changes=l.db.changes(e)}function d(t){var e={live:!0},n=e,r=l.yng.url+"/"+(s.get(l.yng.props,"user")?l.yng.props.user:l.yng.name);e=s.merge(e,s.get(l.yng.props,"to","opts")),n=s.merge(n,s.get(l.yng.props,"from","opts")),l.to=l.db.replicate.to(r,e,p),l.from=l.db.replicate.from(r,n,p).once("uptodate",h(t)).on("uptodate",f).once("error",h(t)).on("complete",f)}function y(){return l.db.info().then(function(t){var n=e.defer();return a(t),l.registerListeners(),d(n),n.promise})}function v(){var t=new u(l.yng.url+"/"+(s.get(l.yng.props,"user")?l.yng.props.user:l.yng.name));return s.doAndOnce(function(){return t.destroy()},"destroyed",t)}var l=this;this.yng=new o(t,n,r);var g={opts:{filter:function(t){return 0!==t._id.indexOf("_design")}}};this.yng.props={changes:g,to:g,from:g},this.db=null,this.to=null,this.from=null,this.changes=null;var m=l.yng.name+"_"+c;this.db=new u(m),this.provider=function(){return l.db},this.bind=function(t){return l.yng.bound()?l.yng.bindModel(t):(l.db.setMaxListeners(20),l.yng.scope=t,l.db.on("error",l.yng.error),i(function(){return y()}))},this.cancel=function(){l.changes&&l.changes.cancel(),l.to&&l.to.cancel(),l.from&&l.from.cancel()},this.destroy=function(t){l.cancel();var n=s.doAndOnce(function(){return l.db.destroy()},"destroyed",this.db),r=[n];return t||r.push(v()),e.all(r).then(function(){return l.yng.destroy()})},this.copyApi=function(t){l.yng.copyApi(t);var e=["provider","bind","destroy"];s.copyFns(e,l,t)}}}},{"../yng":10,"../yng-utils":9,pouchdb:1}],5:[function(t){"use strict";var e=t("../angular"),n=(t("../index.js"),e.module("factoryng"));n.factory("Pouchyng",["$q","$timeout",t("./pouchyng")])},{"../angular":7,"../index.js":8,"./pouchyng":6}],6:[function(t,e){"use strict";var n=t("../yng-utils"),r=t("./pouchyng-common");e.exports=function(t,e){var i=new r(t,e),o=new n(t);return function(t,n,r){function s(t){return t.$id=t._id,t}function u(t){f.yng.createDoc(s(t.doc))}function c(t){var e=s(t.doc),n=f.yng.get(e.$id);n?e.$priority!==n.$priority?f.yng.moveDoc(e):f.yng.updateDoc(e):f.yng.createDoc(e)}function p(t){f.yng.removeDoc(t.doc._id)}var f=new i(t,n,r,"pouchyng");f.copyApi(this),f.map=function(){return f.db.allDocs({include_docs:!0}).then(function(t){t.rows.forEach(function(t){t.doc.$id=t.id,f.yng.push(t.doc)})})},f.registerListeners=function(){var t=p;f.db.on("create",u).on("update",c).on("delete",t)},this.create=function(t){return e(function(){return f.yng.setPriorityIfNeeded(t),f.db.post(t).then(function(e){return t.$id=e.id,t._id=e.id,t._rev=e.rev,f.yng.push(t),t})})},this.update=function(t){return e(function(){t._id=t.$id;var e=o.clone(t);return delete e.$id,f.db.put(e).then(function(e){return t._rev=e.rev,f.yng.set(t),t})})},this.remove=function(t){return e(function(){var e=f.yng.toId(t),n=f.yng.get(e);return f.db.remove(n).then(function(){return f.yng.remove(e)})})},this.setPriority=function(t,n){return e(function(){var e=f.yng.toId(t),r=f.yng.get(e);r.$priority=n,r._id=r.$id;var i=o.clone(r);return delete i.$id,f.db.put(i).then(function(t){return r._rev=t.rev,f.yng.moveDoc(r),r})})}}}},{"../yng-utils":9,"./pouchyng-common":4}],7:[function(t,e){t("angular"),e.exports=angular},{angular:1}],8:[function(t){"use strict";var e=t("./angular"),n=e.module("factoryng",[]);n.service("yngutils",["$q",t("./yng-utils")]),n.factory("Yng",["$q","$timeout",t("./yng")])},{"./angular":7,"./yng":10,"./yng-utils":9}],9:[function(t,e){"use strict";e.exports=function(t){this.ASC=1,this.DESC=2,this.replace=function(t,e){for(var n in t)this.notDefined(e[n])&&delete t[n];for(n in e)t[n]=e[n]},this.isString=function(t){return"string"==typeof t||t instanceof String},this.isNumeric=function(t){return!isNaN(t)},this.notDefined=function(t){return"undefined"==typeof t},this.isFunction=function(t){return"function"==typeof t},this.clone=function(t){return JSON.parse(JSON.stringify(t))},this.copyFns=function(t,e,n){t.forEach(function(t){n[t]=function(){return e[t].apply(e,arguments)}})},this.forEach=function(t,e){for(var n in t)t.hasOwnProperty(n)&&e(t[n],n,t)},this.doAndOnce=function(e,n,r){var i=t.defer(),o=t.defer();return r.once(n,function(){var t=arguments;return i.promise.then(function(e){o.resolve({action:e,event:t})})}),e().then(function(){return i.resolve(arguments),o.promise})},this.merge=function(t,e){var n,r={};if(t)for(n in t)r[n]=t[n];if(e)for(n in e)r[n]=e[n];return r},this.get=function(){if(arguments&&"undefined"!=typeof arguments[0]){for(var t=arguments[0],e=1;e<arguments.length;e++){var n=arguments[e];if(null===t||"undefined"==typeof t[n])return;t=t[n]}return t}}}},{}],10:[function(t,e){"use strict";var n=t("inherits"),r=t("events").EventEmitter,i=t("./yng-utils");e.exports=function(t,e){var o=0,s=new i(t),u=function(t,e,n){this.name=t,this.url=e,this.sortBy=n,this.model=[],this.map={},this.sorting=!1,this.scope=null,this.props={}};n(u,r);var c=100,p=function(t){return function(e,n){var r=e.$priority-n.$priority;return t===s.DESC?-r:r}};return u.prototype.sortIfNeeded=function(){this.sortBy&&this.model.sort(this.sortBy===s.ASC||this.sortBy===s.DESC?p(this.sortBy):this.sortBy)},u.prototype.sortSoonIfNeeded=function(){if(!this.sorting){this.sorting=!0;var t=this;e(function(){t.sortIfNeeded(),t.sorting=!1},c)}},u.prototype.get=function(t){return this.map[t]},u.prototype.at=function(t){return this.model[t]},u.prototype.set=function(t){this.exists(t.$id)&&s.replace(this.get(t.$id),t)},u.prototype.setProperty=function(t,e,n){this.map[t][e]=n},u.prototype.exists=function(t){return this.map[t]?!0:!1},u.prototype.push=function(t){this.exists(t.$id)||(this.map[t.$id]=t,this.model.push(t))},u.prototype.remove=function(t){var e=this.map[t];return e&&(this.model.splice(this.model.indexOf(e),1),delete this.map[t]),e},u.prototype.length=function(){return this.model.length},u.prototype.bindModel=function(t){var n=this;return e(function(){return n.scope=t,t[n.name]=n.model,n.model})},u.prototype.bound=function(){return this.scope&&this.scope[this.name]?!0:!1},u.prototype.applyFactory=function(t){var e=this;return function(){return t.apply(e,arguments)}},u.prototype.createDoc=function(t){var n=this;return e(function(){return n.push(t),n.emit("create",t),t})},u.prototype.updateDoc=function(t){var n=this;return e(function(){return n.set(t),n.emit("update",t),t})},u.prototype.removeDoc=function(t){var n=this;return e(function(){var e=n.toId(t),r=n.remove(e);return n.emit("remove",r),r})},u.prototype.moveDoc=function(t){var n=this;return e(function(){return n.get(t.$id).$priority!==t.$priority&&(n.set(t),n.sortSoonIfNeeded()),n.emit("move",t),t})},u.prototype.setPriorityIfNeeded=function(t){s.notDefined(t.$priority)&&(t.$priority=this.length())},u.prototype.toId=function(t){var e=s.isString(t)||s.isNumeric(t)?t:t.$id;if(s.notDefined(e))throw new Error("missing $id");return e},u.prototype.forEach=function(t,e){return this.model.forEach(t,e)},u.prototype.cleanup=function(){return t.when()},u.prototype.provider=function(){return null},u.prototype.destroy=function(){return this.removeAllListeners(),this.model=[],this.map={},t.when()},u.prototype.error=function(t){this.emit("error",t)},u.prototype.nextId=function(){return++o},u.prototype.properties=function(t){return"undefined"==typeof t?this.props:void(this.props=t)},u.prototype.copyApi=function(t){var e=["sortIfNeeded","sortSoonIfNeeded","get","at","set","setProperty","exists","push","remove","length","forEach","cleanup","provider","destroy","bound","properties","on","once","removeListener"];s.copyFns(e,this,t)},u}},{"./yng-utils":9,events:2,inherits:3}]},{},[5]);